CLASS_NAMES: ['barrier', 'bicycle', 'bus', 'car', 'construction_vehicle', 'motorcycle', 'pedestrian',
              'traffic_cone', 'trailer', 'truck', 'driveable_surface',
              'other_flat', 'sidewalk', 'terrain', 'manmade', 'vegetation']

DATA_CONFIG:
  _BASE_CONFIG_: cfgs/dataset_configs/nuscenes_dataset.yaml
  DATASET: NuScenesPanopticDataset
  XYZ_NORM: False
  COLLATE_FN: collate_batch_lai
  MIN_SPATIAL_SCALE: 128
  VOXEL_SIZE: [0.1, 0.1, 0.1]

  DATA_PROCESSOR:
    PROCESS_LIST: [ custom_voxelization_one ]

    custom_voxelization_one:
      xyz_norm: False
      voxel_label: False
  
  inst_class_idx: [0, 1, 2, 3, 4, 5, 6, 7, 8, 9, 10]  # must be continous
  stuff_class_idx: [11, 12, 13, 14, 15]
  sem2ins_classes: []
  inst_label_shift: 0
  MIN_GT_POINTS: 0

OSS:
  DATA: False

MODEL:
  NAME: SparseUNetTextSeg
  REMAP_FROM_LAI: False
  REMAP_FROM_NOADAPTER: False

  BACKBONE_3D:
    NAME: SparseUNetIndoor
    IN_CHANNEL: 4
    MID_CHANNEL: 32
    BLOCK_RESIDUAL: True
    BLOCK_REPS: 2
    NUM_FILTERS: [32, 64, 128, 256, 256]
    CUSTOM_SP1X1: False

  ADAPTER:
    NAME: VLAdapter
    EVAL_ONLY: False
    NUM_ADAPTER_LAYERS: 1
    TEXT_DIM: -1
    LAST_NORM: True
    FEAT_NORM: False

  TASK_HEAD:
    NAME: TextSegHead
    VOXEL_LOSS: False

    TEXT_EMBED:
      NAME: CLIP
      NORM: True
      PATH: text_embed/nuscenes_16_clip-ViT-B16_text_embed.pth

  INST_HEAD:
    NAME: InstHead

    BLOCK_RESIDUAL: True
    CUSTOM_SP1X1: False

    CLUSTERING:
      PREPARE_EPOCH: 20
      GROUPING_CFG:
        SCORE_THR: 0.2
        RADIUS: 0.1
        MEAN_ACTIVE: 300
        CLASS_NUMPOINT_MEAN: [-1., -1., -1., -1., -1., -1., -1., -1., -1., -1.,
                              -1., -1., -1., -1., -1., -1., -1., -1., -1., -1.]
        NPOINT_THR: 10  # absolute if class_numpoint == -1, relative if class_numpoint != -1
        IGNORE_CLASSES: [11, 12, 13, 14, 15]
      INST_VOXEL_CFG:
        SCALE: 5
        SPATIAL_SHAPE: 20
      LOSS_CFG:
        MAX_PROPOSAL_NUM: 200
        POS_IOU_THR: 0.5
      TEST_CFG:
        # x4_split: False
        CLS_SCORE_THR: 0.001
        MASK_SCORE_THR: -0.5
        MIN_NPOINT: 25
        PANOPTIC_EVAL:
          SKIP_IOU: 0.5
        EVAL_TASKS: [panoptic]
    EVAL_MIN_NPOINT: 15

    FIXED_MODULES: []
    SEMANTIC_ONLY: False
    OFFSET_LOSS: l1

TEXT_ENCODER:
  NAME: CLIP
  BACKBONE: ViT-B/16  # ['RN50', 'RN101', 'RN50x4', 'RN50x16', 'RN50x64', 'ViT-B/32', 'ViT-B/16', 'ViT-L/14']
  TEMPLATE: identity
  EXTRACT_EMBED: False  # Online extract text embedding from class or not

OPTIMIZATION:
  BATCH_SIZE_PER_GPU: 4
  TEST_BATCH_SIZE_PER_GPU: 1
  NUM_EPOCHS: 70
  LR: 0.01
  SCHEDULER: poly
  OPTIMIZER: adamw
  WEIGHT_DECAY: 0.01
  MOMENTUM: 0.9
  STEP_EPOCH: 70
  MULTIPLIER: 0.1
  CLIP_GRAD: False
  PCT_START: 0.4
  DIV_FACTOR: 1
  MOMS: [0.95, 0.85]
  # for poly scheduler
  POWER: 0.9
  SAVE_EPOCH: [20]

OTHERS:
  PRINT_FREQ: 50
  EVAL_FREQ: 5
  CKPT_SAVE_INTERVAL: 1
  SYNC_BN: False
  USE_AMP: True
  FIND_UNUSED_PARAMETERS: True

OSS:
  DATA: False