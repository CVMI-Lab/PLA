_BASE_CONFIG_: cfgs/scannet_models/zs/spconv_clip_caption.yaml

DATA_CONFIG:
  # TODO: make base + novel = all.
  ignore_class_idx: [ 19 ]

  LOAD_KD_LABEL_TRAIN: True
  KD_LABEL_DIR: ../data/scannetv2/scannet_multiview_lseg
  KD_LABEL_NORM: True

MODEL:

  ADAPTER:
    NUM_ADAPTER_LAYERS: 2
    LAST_NORM: False  # need to perform KD

  TASK_HEAD:
    NAME: TextSegHead
    EVAL_ONLY: True
    IN_FEAT_NAME: adapter_feats
    IN_CHANNEL: 512

    TEXT_EMBED:
      NAME: CLIP
      NORM: True
      PATH: text_embed/scannet_clip-ViT-B32_lseg.pth
    LOSS_WEIGHT: 0.0

  CAPTION_HEAD:
    NAME: CaptionHead
    IN_FEAT_NAME: adapter_feats
    POOLING_TYPE: avg
    FEAT_NORM: True  # better to align with KD head
    LOGIT_SCALE:
      value: 100.0
      learnable: True
    CUDA_ENABLED: True
    LOSS_WEIGHT:
      SCENE: 0.1
      VIEW: 0.1
      ENTITY: 0.1
  
  KD_HEAD:
    NAME: KDHeadTemplate
    IN_FEAT_NAME: adapter_feats
    FEAT_NORM: True

    LOSS_CONFIG:
      LOSS_WEIGHT: 1.0

TEXT_ENCODER:
  BACKBONE: ViT-B/32  # ['RN50', 'RN101', 'RN50x4', 'RN50x16', 'RN50x64', 'ViT-B/32', 'ViT-B/16', 'ViT-L/14']
  TEMPLATE: lseg
