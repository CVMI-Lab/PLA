CLASS_NAMES: [wall, floor, cabinet, bed, chair, sofa, table, door, window, bookshelf, picture, counter, desk,
              curtain, refrigerator, showercurtain, toilet, sink, bathtub, otherfurniture]

DATA_CONFIG:
  _BASE_CONFIG_: cfgs/dataset_configs/scannet_dataset.yaml
  DATASET: ScanNetInstDataset
  inst_class_idx: [2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 18, 19]
  sem2ins_classes: []
  inst_label_shift: 2
  ignore_class_idx: []
  LOAD_KD_LABEL_TEST: True
  KD_LABEL_DIR: ../data/scannetv2/lseg_feats_125k_norm
  KD_LABEL_NORM: True

MODEL:
  NAME: SparseUNetTextSeg
  REMAP_FROM_3DLANG: False

  # VFE:
  #   NAME: IndoorVFE
  #   USE_XYZ: True

  # ADAPTER:
  #   NAME: VLAdapter
  #   EVAL_ONLY: False
  #   NUM_ADAPTER_LAYERS: 1
  #   TEXT_DIM: -1
  #   LAST_NORM: True

  TASK_HEAD:
    NAME: TextSegHead
    FEAT_NORM: False
    EVAL_ONLY: True
    IN_FEAT_NAME: adapter_feats
    IN_CHANNEL: 512
    NO_V2P_MAP: True

    TEXT_EMBED:
      NAME: CLIP
      NORM: True
      PATH: text_embed/scannet_clip-ViT-B32_id.pth
    LOGIT_SCALE:
      value: 100.0  # !! due to the semantic score is the cos similarity, which affects instance grouping
      learnable: False

  
  INST_HEAD:
    NAME: InstHead
    IN_FEAT_NAME: adapter_feats
    IN_CHANNEL: 512
    NO_V2P_MAP: True

    BLOCK_RESIDUAL: True
    CUSTOM_SP1X1: True

    CLUSTERING:
      PREPARE_EPOCH: -100
      GROUPING_CFG:
        SCORE_THR: 0.2
        RADIUS: 0.04
        MEAN_ACTIVE: 50  # !! not offsets learning, thus smaller than 300
        CLASS_NUMPOINT_MEAN: [-1., -1., -1., -1., -1., -1., -1., -1., -1., -1.,
                              -1., -1., -1., -1., -1., -1., -1., -1., -1., -1.]
        NPOINT_THR: 50  # absolute if class_numpoint == -1, relative if class_numpoint != -1
        IGNORE_CLASSES: [0, 1]
      INST_VOXEL_CFG:
        SCALE: 50
        SPATIAL_SHAPE: 20
      LOSS_CFG:
        MAX_PROPOSAL_NUM: 200
        POS_IOU_THR: 0.5
      TEST_CFG:
        # x4_split: False
        CLS_SCORE_THR: 0.001
        MASK_SCORE_THR: -0.5
        MIN_NPOINT: 100

    FIXED_MODULES: []
    SEMANTIC_ONLY: False

TEXT_ENCODER:
  NAME: CLIP
  BACKBONE: ViT-B/32  # ['RN50', 'RN101', 'RN50x4', 'RN50x16', 'RN50x64', 'ViT-B/32', 'ViT-B/16', 'ViT-L/14']
  TEMPLATE: lseg
  EXTRACT_EMBED: True  # Online extract text embeding from class or not
  CATEGORY_NAMES: [wall, floor, cabinet, bed, chair, sofa, table, door, window, bookshelf, picture, counter, desk,
                   curtain, refrigerator, showercurtain, toilet, sink, bathtub, otherfurniture]
#  BERT:
#  BACKBONE: bert-base-uncased

OPTIMIZATION:
  TEST_BATCH_SIZE_PER_GPU: 1
  BATCH_SIZE_PER_GPU: 4

OTHERS:
  PRINT_FREQ: 20
  SYNC_BN: False
  USE_AMP: True
